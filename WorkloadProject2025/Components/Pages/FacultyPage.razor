@page "/facultypage"
@using WorkloadProject2025.Data.Models
@using WorkloadProject2025.Services
@inject FacultyService _facultyService

<FacultyForm OnSaved="Save"></FacultyForm>

<MudCard Class="mx-auto mt-6" Style="max-width: 850px;">
    <MudCardHeader>
        <MudText Typo="Typo.h5" Class="font-semibold">Current Faculty</MudText>
        <MudSpacer />
        <MudButton Variant="Variant.Filled" Color="Color.Primary" Style="text-transform: uppercase;">Add New Faculty</MudButton>
    </MudCardHeader>

    <MudCardContent>
        <MudTable Items="@faculty" Hover="true" Breakpoint="Breakpoint.Sm">
            <HeaderContent>
                <MudTh>Name</MudTh>
                <MudTh>Email</MudTh>
                <MudTh>Phone</MudTh>
                <MudTh></MudTh>
            </HeaderContent>
            <RowTemplate>
                <MudTd DataLabel="Name">@context.FirstName @context.LastName</MudTd>
                <MudTd DataLabel="Email">@context.Email</MudTd>
                <MudTd DataLabel="Phone">@context.PhoneNumber</MudTd>
                <MudTd DataLabel="">
                    <MudButton Variant="Variant.Filled" 
                               Color="Color.Error" 
                               Size="Size.Small"
                               OnClick="@(async () => await DeleteFaculty(context.Email))">
                        Delete
                    </MudButton>
                </MudTd>
            </RowTemplate>
        </MudTable>
    </MudCardContent>
</MudCard>

@code {
    List<Faculty> faculty = new();

    protected override async Task OnInitializedAsync()
    {
        faculty = await _facultyService.GetAllAsync();
    }

    public async Task Save()
    {
        faculty = await _facultyService.GetAllAsync();
        StateHasChanged();
    }

    private async Task DeleteFaculty(string email)
    {
        await _facultyService.DeleteAsync(email);
        faculty = await _facultyService.GetAllAsync();
        StateHasChanged();
    }
}
