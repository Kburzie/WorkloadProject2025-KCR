@using WorkloadProject2025.Data.Models
@using WorkloadProject2025.Services
@inject CourseService courseService



<MudCard Class="mx-auto mt-6" Style="max-width: 450px;">
    <MudCardHeader>
        <MudText Typo="Typo.h6" Class="font-semibold">Add New Course</MudText>
    </MudCardHeader>

    <MudCardContent>
        <MudStack Spacing="2">
            <MudTextField Label="Course Name"
                          @bind-Value="course.Name"
                          Required="true"
                          Adornment="Adornment.Start"
                          AdornmentIcon="@Icons.Material.Filled.Business" />


            <MudNumericField T="int"
                            Label="Course Hours"
                            @bind-Value="course.Hours"
                            Required="true"
                            Adornment="Adornment.Start"
                            AdornmentIcon="@Icons.Material.Filled.AccessTime" />
            <MudSelect T="int"
                       @bind-value="course.ProgramOfStudyId"
                       Required="true">
                @foreach (var prog in programOfStudy)
                {
                    <MudSelectItem Value="@prog.Id">@prog.Name</MudSelectItem>
                }

            </MudSelect>
            
        </MudStack>
    </MudCardContent>

    <MudCardActions Class="justify-end">
        <MudButton Variant="Variant.Text" Color="Color.Secondary" OnClick="Cancel">Cancel</MudButton>
        <MudButton Color="Color.Primary" Variant="Variant.Filled" OnClick="Save">Save</MudButton>
    </MudCardActions>
</MudCard>

@code {
    [CascadingParameter]
    MudBlazor.IDialogReference? MudDialog { get; set; }

    private Course course { get; set; } = new Course();

    [Parameter]
    public EventCallback OnCourseSaved { get; set; }

    [Parameter]
    public List<ProgramOfStudy> programOfStudy { get; set; } = new(); // <-- prevents null

    private void Cancel()
    {
        course = new Course(); // reset form
        MudDialog?.Close(DialogResult.Cancel());
    }

    private async Task Save()
    {
        await courseService.AddAsync(course);
        await OnCourseSaved.InvokeAsync();
        course = new Course(); // reset form
        MudDialog?.Close(DialogResult.Ok(true));
    }
}